<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phương Án Thi Công - Chuẩn Mẫu PDF - V3.0</title>
    <style>
        :root {
            --primary-color: #0056b3;
            --bg-color: #f4f6f9;
        }

        body {
            font-family: 'Times New Roman', serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            color: #000;
        }

        /* --- GIAO DIỆN NHẬP LIỆU (ẨN KHI IN) --- */
        .input-panel {
            font-family: 'Segoe UI', sans-serif;
            max-width: 900px;
            margin: 0 auto 30px auto;
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .input-panel h2 { color: var(--primary-color); text-align: center; margin-top: 0; }
        .version-info { text-align: right; font-style: italic; color: #666; font-size: 0.9rem; margin-bottom: 10px; }

        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-weight: 600; margin-bottom: 5px; }
        .form-control {
            width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 1rem;
        }
        
        .worker-list { border: 1px solid #ddd; padding: 10px; max-height: 300px; overflow-y: auto; border-radius: 4px; }
        .worker-item { display: flex; align-items: center; padding: 5px; border-bottom: 1px solid #eee; }
        .worker-item:last-child { border-bottom: none; }
        .worker-name { flex: 1; font-weight: 500; }
        .worker-role { margin-left: 10px; padding: 5px; border: 1px solid #ddd; border-radius: 3px; }

        .btn-action {
            display: block; width: 100%; padding: 12px; background: var(--primary-color); color: white;
            border: none; border-radius: 5px; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-top: 20px;
        }
        .btn-action:hover { background: #004494; }
        
        /* --- GIAO DIỆN IN (KHỔ A4 CHUẨN) --- */
        #print-document {
            display: none; /* Ẩn mặc định */
            background: white;
            width: 210mm;
            min-height: 297mm;
            padding: 15mm 20mm; /* Lề trái 20mm, phải 15mm */
            margin: 0 auto;
            box-sizing: border-box;
            line-height: 1.3;
            font-size: 13pt; /* Cỡ chữ chuẩn văn bản */
        }

        /* Header Quốc hiệu/Tiêu ngữ */
        .header-table { width: 100%; margin-bottom: 10px; border: none; }
        .header-table td { vertical-align: top; text-align: center; padding: 0; }
        .company-name { font-weight: bold; font-size: 11pt; }
        .unit-name { font-weight: bold; font-size: 11pt; text-decoration: underline; }
        .motto { font-weight: bold; font-size: 11pt; }
        .sub-motto { font-weight: bold; font-size: 12pt; border-bottom: 1px solid #000; display: inline-block; padding-bottom: 3px; }
        .date-line { font-style: italic; font-size: 12pt; margin-top: 5px; }

        .doc-title { text-align: center; font-weight: bold; font-size: 14pt; margin: 20px 0 10px 0; }
        .doc-subtitle { text-align: center; font-weight: bold; font-size: 13pt; margin-bottom: 20px; text-transform: uppercase; }

        /* Các mục lớn I, II, III... */
        .section-header { font-weight: bold; margin-top: 15px; margin-bottom: 5px; text-transform: uppercase;}
        .section-sub { font-weight: bold; margin-top: 10px; margin-bottom: 5px; }
        
        .content-para { text-align: justify; margin-bottom: 5px; margin-left: 0; }
        .list-item { margin-left: 20px; margin-bottom: 5px; text-align: justify; }

        /* Bảng biểu chuẩn */
        .standard-table { width: 100%; border-collapse: collapse; margin: 10px 0; font-size: 12pt; }
        .standard-table th, .standard-table td { border: 1px solid #000; padding: 5px; vertical-align: middle; }
        .standard-table th { background-color: #f0f0f0; text-align: center; font-weight: bold; }
        .text-center { text-align: center; }
        .text-bold { font-weight: bold; }

        /* Chữ ký */
        .sign-table { width: 100%; margin-top: 30px; border: none; }
        .sign-table td { text-align: center; vertical-align: top; width: 50%; border: none; }
        .sign-title { font-weight: bold; text-transform: uppercase; margin-bottom: 80px; }

        /* Chế độ Editable cho phần in (để sửa nhanh lỗi chính tả khi xem trước) */
        .editable { outline: none; }
        .editable:hover { background-color: #fff8dc; cursor: text; }

        @media print {
            body { background: white; padding: 0; }
            .input-panel { display: none !important; }
            #print-document { display: block !important; width: 100%; margin: 0; padding: 15mm 15mm; page-break-after: always; }
            @page { size: A4; margin: 0; }
        }
    </style>
</head>
<body>

    <div class="input-panel">
        <div class="version-info">Version 3.0 | Ngày: 16/01/2026</div>
        <h2>NHẬP THÔNG TIN PHƯƠNG ÁN</h2>
        
        <div class="form-group">
            <label>Ngày thực hiện:</label>
            <input type="date" id="inpDate" class="form-control">
        </div>
        
        <div class="form-group">
            <label>Tên công việc (Viết in hoa):</label>
            <input type="text" id="inpJobName" class="form-control" placeholder="Ví dụ: PHỐI HỢP THÍ NGHIỆM HỘP LINEBOX...">
        </div>

        <div class="form-group">
            <label>Địa điểm công tác:</label>
            <input type="text" id="inpLocation" class="form-control" placeholder="Ví dụ: Trụ 23, Trạm Tân Bình 2...">
        </div>

        <div class="form-group">
            <label>Nội dung chi tiết (Mục 1 - Thông tin công trình):</label>
            <textarea id="inpContent" class="form-control" rows="3" placeholder="Chi tiết nội dung công tác..."></textarea>
        </div>

        <div class="form-group">
            <label>Phân công nhân sự (Chọn và gán chức danh):</label>
            <div class="worker-list" id="workerList">
                </div>
        </div>

        <div class="form-group">
            <label>Người lập (Thiết lập):</label>
            <input type="text" id="inpCreator" class="form-control" value="Nguyễn Ngọc Thành Trường">
        </div>

        <div class="form-group">
            <label>Người duyệt (Đội phó/Đội trưởng):</label>
            <input type="text" id="inpApprover" class="form-control" value="Trần Công Đẹp">
        </div>

        <button class="btn-action" onclick="generateAndPrint()">XEM & IN PHƯƠNG ÁN</button>
    </div>

    <div id="print-document">
        
        <table class="header-table">
            <tr>
                <td style="width: 45%;">
                    CÔNG TY LƯỚI ĐIỆN CAO THẾ<br>
                    <span class="unit-name">ĐỘI QUẢN LÝ LƯỚI ĐIỆN 2</span><br>
                    Số: ......./PA-DQL2
                </td>
                <td style="width: 55%;">
                    <span class="motto">CỘNG HÒA XÃ HỘI CHỦ NGHĨA VIỆT NAM</span><br>
                    <span class="sub-motto">Độc lập - Tự do - Hạnh phúc</span><br>
                    <div class="date-line" id="printDateLine">TP.HCM, ngày ... tháng ... năm 2026</div>
                </td>
            </tr>
        </table>

        <div class="doc-title">PHƯƠNG ÁN THI CÔNG VÀ BIỆN PHÁP AN TOÀN</div>
        <div class="doc-subtitle content-editable" id="printJobTitle">...</div>

        <div class="section-header">I. CƠ SỞ THIẾT LẬP:</div>
        <div class="list-item">- Căn cứ Quy trình An toàn điện số 959/QĐ-EVN ngày 26/07/2021 của Tổng Giám đốc Tập đoàn Điện lực Việt Nam;</div>
        <div class="list-item">- Căn cứ quyết định 881/QĐ-EVN ngày 15/07/2021 V/v ban hành Quy trình an toàn thủy, cơ, nhiệt, hóa trong Tập đoàn Điện lực Quốc gia Việt Nam;</div>
        <div class="list-item">- Căn cứ Quy trình quản lý vận hành và Sửa chữa đường dây trên không 110kV (theo QĐ số 4086/QĐ-EVNHCMC ngày 31/12/2015);</div>
        <div class="list-item">- Căn cứ Hướng dẫn lập Phương án Thi công và Biện pháp An toàn (theo QĐ số 127/QĐ-LĐCT ngày 18/01/2024);</div>
        <div class="list-item">- Căn cứ Hướng dẫn thực hiện công tác chặt tỉa, khai quang cây xanh (HD số 460/HD-LĐCT ngày 8/3/2019);</div>
        <div class="list-item">- Căn cứ biên bản khảo sát hiện trường ngày <span id="printSurveyDate">...</span>.</div>
        <div class="content-para">
            -> Tổ đường dây 1 lập phương án thi công và biện pháp an toàn thực hiện công tác <span id="printJobNameShort" style="font-weight: bold;">...</span> như sau:
        </div>

        <div class="section-sub">1. Các thông tin về công trình:</div>
        <div class="list-item"><b>- Nội dung công tác:</b> <span id="printContentDetail" class="editable" contenteditable="true">...</span></div>
        <div class="list-item"><b>- Địa điểm công tác:</b> <span id="printLocation" class="editable" contenteditable="true">...</span></div>
        <div class="list-item"><b>- Đơn vị thi công:</b> Tổ đường dây.</div>

        <div class="section-sub">2. Thời gian và Phạm vi cắt điện:</div>
        <div class="list-item">- Thời gian: Từ 08h00 đến 16h00 (Dự kiến).</div>
        <div class="list-item">- Phạm vi cắt điện: <span class="editable" contenteditable="true">Cô lập đường dây 110kV Phú Lâm (171) - Pouyen (171) - Tân Bình 2 (172).</span></div>

        <div class="section-sub">3. Khối lượng công tác thực hiện:</div>
        <div class="list-item editable" contenteditable="true">- Tại trụ 23: Phối hợp thí nghiệm chống sét van.</div>
        <div class="list-item editable" contenteditable="true">- Trong trạm Tân Bình 2: Thử nghiệm hộp LineBox ngăn 172.</div>
        <div class="list-item editable" contenteditable="true">- Chặt cây khai quang khoảng trụ 02-07, 33-34.</div>

        <div class="section-sub">4. Biện pháp thi công:</div>
        <div class="list-item editable" contenteditable="true">- Thực hiện tháo hộp LineBox và tiếp địa để thí nghiệm điện lực thực hiện việc thí nghiệm.</div>
        <div class="list-item editable" contenteditable="true">- Dùng xe gàu nâng người, dụng cụ đồ nghề, đeo ủng găng tay cách điện, dùng sào thử điện cao áp thử hết điện, phối hợp thực hiện.</div>

        <div class="section-sub">5. Khối lượng vật tư, dụng cụ:</div>
        <div style="font-style: italic;">5.1. Vật tư:</div>
        <table class="standard-table">
            <thead>
                <tr>
                    <th style="width: 10%;">STT</th>
                    <th>Tên vật tư</th>
                    <th style="width: 15%;">Đơn vị</th>
                    <th style="width: 15%;">Số lượng</th>
                    <th>Ghi chú</th>
                </tr>
            </thead>
            <tbody class="editable" contenteditable="true">
                <tr><td class="text-center">1</td><td>Găng tay vải</td><td class="text-center">Đôi</td><td class="text-center">06</td><td></td></tr>
                <tr><td class="text-center">2</td><td>Sứ thủy tinh 70kN</td><td class="text-center">Bát</td><td class="text-center">0</td><td>Dự phòng</td></tr>
            </tbody>
        </table>

        <div style="font-style: italic;">5.2. Dụng cụ thi công:</div>
        <table class="standard-table">
            <thead>
                <tr>
                    <th style="width: 10%;">STT</th>
                    <th>Tên dụng cụ</th>
                    <th style="width: 15%;">Đơn vị</th>
                    <th style="width: 15%;">Số lượng</th>
                </tr>
            </thead>
            <tbody class="editable" contenteditable="true">
                <tr><td class="text-center">1</td><td>Bộ đồ nghề thi công</td><td class="text-center">Bộ</td><td class="text-center">01</td></tr>
                <tr><td class="text-center">2</td><td>Dây luộc, Puly</td><td class="text-center">Bộ</td><td class="text-center">01</td></tr>
            </tbody>
        </table>

        <div style="font-style: italic;">5.3. Trang cụ an toàn:</div>
        <table class="standard-table">
            <thead>
                <tr>
                    <th style="width: 10%;">STT</th>
                    <th>Tên trang cụ</th>
                    <th style="width: 15%;">Đơn vị</th>
                    <th style="width: 15%;">Số lượng</th>
                </tr>
            </thead>
            <tbody class="editable" contenteditable="true">
                <tr><td class="text-center">1</td><td>Sào thử điện 110kV</td><td class="text-center">Cây</td><td class="text-center">01</td></tr>
                <tr><td class="text-center">2</td><td>Tiếp địa lưu động cao thế</td><td class="text-center">Bộ</td><td class="text-center">01</td></tr>
                <tr><td class="text-center">3</td><td>Găng/Ủng cách điện</td><td class="text-center">Bộ</td><td class="text-center">01</td></tr>
                <tr><td class="text-center">4</td><td>Túi cứu thương</td><td class="text-center">Cái</td><td class="text-center">01</td></tr>
            </tbody>
        </table>

        <div class="section-sub">6. Biện pháp an toàn:</div>
        <div class="list-item">- Thử không còn điện tại vị trí công tác.</div>
        <div class="list-item">- Kiểm tra chất lượng, thời hạn thử nghiệm các dụng cụ an toàn trước khi làm việc.</div>
        <div class="list-item">- CHTT phổ biến nhiệm vụ, phạm vi an toàn và giám sát liên tục.</div>
        <div class="list-item">- Công nhân phải sử dụng đầy đủ phương tiện bảo vệ cá nhân (dây an toàn 2 móc, nón bảo hộ...).</div>
        <div class="list-item editable" contenteditable="true" style="color: red;">* Lưu ý: Giữ khoảng cách an toàn với đường dây 110kV đang vận hành gần kề (nếu có).</div>

        <div class="section-sub">7. Phân công nhiệm vụ tại công trường:</div>
        <table class="standard-table">
            <thead>
                <tr>
                    <th style="width: 10%;">STT</th>
                    <th style="width: 40%;">Họ và tên</th>
                    <th style="width: 15%;">Bậc AT</th>
                    <th>Phân công nhiệm vụ</th>
                </tr>
            </thead>
            <tbody id="printWorkerTable">
                </tbody>
        </table>

        <table class="sign-table">
            <tr>
                <td>
                    <div class="sign-title">DUYỆT<br>ĐỘI PHÓ</div>
                    <br><br><br>
                    <div style="font-weight: bold;" id="printApprover">Trần Công Đẹp</div>
                </td>
                <td>
                    <div class="sign-title">THIẾT LẬP</div>
                    <br><br><br>
                    <div style="font-weight: bold;" id="printCreator">...</div>
                </td>
            </tr>
        </table>
    </div>

    <script>
        // --- Dữ liệu Nhân viên (Thầy có thể sửa ở đây) ---
        const EMPLOYEES = [
            { name: "Nguyễn Ngọc Thành Trường", level: "5/5" },
            { name: "Bùi Dương Đông", level: "5/5" },
            { name: "Phùng Quang Trường", level: "5/5" },
            { name: "Trần Quốc Đạt", level: "2/5" },
            { name: "Nguyễn Thanh Khoa", level: "4/5" },
            { name: "Nguyễn Minh Hải", level: "4/5" },
            { name: "Tài xế xe gàu", level: "-" },
            { name: "Tài xế xe cẩu", level: "-" }
        ];

        const ROLES = [
            "Công nhân thực hiện",
            "CHTT",
            "Người cho phép, Giám sát ATĐ",
            "Cảnh giới giao thông",
            "Lái xe phục vụ"
        ];

        // Khởi tạo ứng dụng
        window.onload = function() {
            // Set ngày mặc định
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('inpDate').value = today;

            // Render danh sách công nhân để chọn
            const workerListDiv = document.getElementById('workerList');
            EMPLOYEES.forEach((emp, index) => {
                const div = document.createElement('div');
                div.className = 'worker-item';
                
                div.innerHTML = `
                    <input type="checkbox" id="chk_${index}" style="transform: scale(1.2);">
                    <div style="margin-left: 10px; flex: 1;">
                        <span class="worker-name">${emp.name}</span>
                        <span style="font-size: 0.8em; color: #666;">(Bậc: ${emp.level})</span>
                    </div>
                    <select id="role_${index}" class="worker-role">
                        ${ROLES.map(r => `<option value="${r}">${r}</option>`).join('')}
                    </select>
                `;
                workerListDiv.appendChild(div);
            });
        };

        // Hàm Xử lý In
        function generateAndPrint() {
            // 1. Lấy dữ liệu từ Form
            const dateVal = document.getElementById('inpDate').value;
            const jobName = document.getElementById('inpJobName').value;
            const location = document.getElementById('inpLocation').value;
            const content = document.getElementById('inpContent').value;
            const creator = document.getElementById('inpCreator').value;
            const approver = document.getElementById('inpApprover').value;

            if(!dateVal || !jobName) {
                alert("Vui lòng nhập Ngày và Tên công việc!");
                return;
            }

            // 2. Điền vào mẫu In
            // Ngày tháng
            const d = new Date(dateVal);
            document.getElementById('printDateLine').textContent = `TP.HCM, ngày ${d.getDate()} tháng ${d.getMonth() + 1} năm ${d.getFullYear()}`;
            document.getElementById('printSurveyDate').textContent = `${d.getDate()}/${d.getMonth() + 1}/${d.getFullYear()}`;
            
            // Thông tin công việc
            document.getElementById('printJobTitle').textContent = "Về việc: " + jobName;
            document.getElementById('printJobNameShort').textContent = jobName;
            document.getElementById('printLocation').textContent = location;
            document.getElementById('printContentDetail').textContent = content;

            // Chữ ký
            document.getElementById('printCreator').textContent = creator;
            document.getElementById('printApprover').textContent = approver;

            // Bảng nhân sự
            const tableBody = document.getElementById('printWorkerTable');
            tableBody.innerHTML = "";
            let stt = 1;

            EMPLOYEES.forEach((emp, index) => {
                const checkbox = document.getElementById(`chk_${index}`);
                if(checkbox.checked) {
                    const role = document.getElementById(`role_${index}`).value;
                    let rowHtml = `
                        <tr>
                            <td class="text-center">${stt++}</td>
                            <td class="text-bold">${emp.name}</td>
                            <td class="text-center">${emp.level}</td>
                            <td class="text-bold">${role}</td>
                        </tr>
                    `;
                    tableBody.innerHTML += rowHtml;
                }
            });

            // 3. Gọi lệnh in
            window.print();
        }
    </script>
</body>
</html>
